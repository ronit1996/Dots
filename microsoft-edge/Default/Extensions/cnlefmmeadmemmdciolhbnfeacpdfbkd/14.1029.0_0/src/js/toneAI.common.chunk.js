(self.webpackChunk=self.webpackChunk||[]).push([[7725],{72311:(e,t,i)=>{i.r(t),i.d(t,{ToneAIFeature:()=>g});var s=i(40327),n=i(88921),r=i(90361),l=i(74660),o=i(19751),a=i(60797),u=i(17594),d=i(15646),A=i(77610),p=i(35416),c=i(83078),b=i(5114);class g{constructor(e,t,i){this._alertStateService=e,this._getSessionUuid=t,this._gnar=i}initSingleCardAssistantActionsProcessing(e,t){return new o.Observable((()=>{const i=new o.Subscription;return this._subscribeToCommonActions(e,t,i),()=>i.unsubscribe()}))}initAssistantCardActionsProcessing(e,t,i,n,r){return new o.Observable((()=>{const l=new o.Subscription;this._subscribeToCommonActions(t,r,l),l.add(g._getToneAIAlertObservable(n.pipe(o.filter(A.C.isToneAIItem),o.map((e=>e.activeAlert.id))),t).subscribe((e=>this._gnar.toneAIAssistantMiniCardShow(this._getSessionUuidValue(),g._getToneRewriteType(e))))),l.add(g._getToneAIAlertObservable(e.pipe(o.filter(d.lY.isAlertCardShow),o.map((e=>e.alertId))),t).pipe(o.debounceTime(300)).subscribe((e=>this._gnar.toneAIAssistantFullCardShow(this._getSessionUuidValue(),g._getToneRewriteType(e))))),l.add(g._getToneAIAlertObservable(e.pipe(o.filter(d.lY.isAlertApplyAction),o.map((e=>e.alertId))),t).subscribe((e=>this._gnar.toneAIAssistantFullCardReplacementApply(this._getSessionUuidValue(),g._getToneRewriteType(e))))),g._subscribeToMuteOrUndoMuteButtonClick(l,e,i,t,d.lY.isMuteCategoryAction,(e=>this._gnar.toneAIAssistantFullCardMuteButtonClick(this._getSessionUuidValue(),g._getToneRewriteType(e)))),g._subscribeToMuteOrUndoMuteButtonClick(l,e,i,t,d.lY.isUndoMuteCategoryAction,(e=>this._gnar.toneAIAssistantFullCardUndoMuteButtonClick(this._getSessionUuidValue(),g._getToneRewriteType(e))));const a=e.pipe(o.filter(d.lY.isToneAIChangeToneAlternativeAction));return l.add(a.pipe(o.startWith(null),o.pairwise(),o.filter((([e,t])=>(null==e?void 0:e.selectedToneAlternativeIdx)!==(null==t?void 0:t.selectedToneAlternativeIdx))),o.map((([e,t])=>{var i,s;return{oldToneAlternativeIdx:null!==(i=null==e?void 0:e.selectedToneAlternativeIdx)&&void 0!==i?i:null,newToneAlternativeIdx:null!==(s=null==t?void 0:t.selectedToneAlternativeIdx)&&void 0!==s?s:null}})),o.withLatestFrom(g._getToneAIAlertObservable(a.pipe(o.map((e=>e.alertId))),t))).subscribe((([{oldToneAlternativeIdx:e,newToneAlternativeIdx:t},i])=>(0,s.pipe)(i.extraProperties.toneAI,c.bw((s=>{this._gnar.toneAIAssistantFullCardSliderMove(null!==t?s.toneAlternatives[t].name:"",null!==e?s.toneAlternatives[e].name:"",this._getSessionUuidValue(),g._getToneRewriteType(i))})))))),l.add(g._getToneAIAlertObservable(e.pipe(o.filter(d.lY.isAlertIgnoreAction),o.map((e=>e.alertId))),t).subscribe((e=>this._gnar.toneAIAssistantFullCardDismissButtonClick(this._getSessionUuidValue(),g._getToneRewriteType(e))))),()=>l.unsubscribe()}))}_subscribeToCommonActions(e,t,i){i.add(this._alertStateService.newlyHighlightedAlerts.pipe(o.filter(n.S.isToneAIAlert)).subscribe((e=>this._gnar.toneAIAlertUnderlineShow(this._getSessionUuidValue(),g._getToneRewriteType(e))))),i.add(g._getToneAIAlertObservable(t.pipe(o.filter(u.$.isToneAI),o.map((e=>e.id))),e).subscribe((e=>this._gnar.toneAIAlertUnderlineClick(this._getSessionUuidValue(),g._getToneRewriteType(e)))))}_getSessionUuidValue(){return(0,s.pipe)(this._getSessionUuid(),b.getOrElse((()=>"")))}static _getToneRewriteType(e){return`${e.patternName.split("/").slice(2).join("/")}${e.patternNameQualifier?`_${e.patternNameQualifier}`:""}`}static _subscribeToMuteOrUndoMuteButtonClick(e,t,i,n,l,a){e.add(g._getToneAIAlertObservable(t.pipe(o.filter(l),o.withLatestFrom(i),o.map((([e,t])=>p.nL.hasItems(t)?(0,s.pipe)(t.currentLens.items.get(e.id),b.fold((()=>null),(e=>e.value))):null)),o.filter(r.fQ),o.filter(A.C.isToneAIItem),o.map((e=>e.activeAlert.id))),n).subscribe(a))}static _getToneAIAlertObservable(e,t){return e.pipe(o.map(t.getById),a.oA,o.filter(l.bZ.isToneAI))}}}}]);